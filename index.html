<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Profit Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-color: #0b0f1a;
            --surface-color: rgba(30, 41, 59, 0.7);
            --primary-accent: #38bdf8;
            --secondary-accent: #818cf8;
            --success: #10b981;
            --error: #f43f5e;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.1);
            --glass-glow: rgba(56, 189, 248, 0.1);
            --cost-color: #e57373;
            --income-color: #66bb6a;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            background-image:
                radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.1) 0%, transparent 35%),
                radial-gradient(circle at 100% 100%, rgba(129, 140, 248, 0.1) 0%, transparent 35%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 500px;
            padding: 16px;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo h1 {
            font-size: 18px;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(135deg, var(--primary-accent), var(--secondary-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: rgba(30, 41, 59, 0.5);
            padding: 4px;
            border-radius: 14px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .tab-btn {
            flex: 1;
            padding: 10px 4px;
            border: none;
            background: transparent;
            color: var(--text-dim);
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-btn.active {
            background: var(--surface-color);
            color: var(--primary-accent);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-accent), var(--secondary-accent));
            border-radius: 1px;
        }

        .tab-content {
            display: none;
            animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .tab-content.active {
            display: block;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: var(--surface-color);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-accent), transparent);
            opacity: 0.5;
        }

        .input-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 12px;
            color: var(--text-dim);
            margin-bottom: 4px;
            padding-left: 2px;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper span.prefix {
            position: absolute;
            left: 10px;
            color: var(--text-dim);
            font-size: 15px;
            pointer-events: none;
        }

        .input-wrapper span.suffix {
            position: absolute;
            right: 10px;
            color: var(--text-dim);
            font-size: 15px;
            pointer-events: none;
        }

        input,
        select {
            width: 100%;
            padding: 12px 12px 12px 24px;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: white;
            font-family: 'Outfit', sans-serif;
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus {
            border-color: var(--primary-accent);
            background: rgba(15, 23, 42, 0.7);
        }

        select {
            padding-left: 12px;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
        }

        input.no-prefix {
            padding-left: 12px;
        }

        input[readonly] {
            opacity: 0.7;
            cursor: default;
        }

        /* Display-only calculated field */
        .display-field {
            padding: 12px;
            background: rgba(56, 189, 248, 0.05);
            border: 1px solid rgba(56, 189, 248, 0.15);
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .display-field .display-label {
            font-size: 13px;
            color: var(--text-dim);
        }

        .display-field .display-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-accent);
        }

        /* Smart default reset button */
        .smart-input-row {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .smart-input-row .input-wrapper {
            flex: 1;
        }

        .reset-btn {
            width: 36px;
            height: 36px;
            border: 1px solid var(--border-color);
            background: rgba(15, 23, 42, 0.5);
            color: var(--text-dim);
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .reset-btn:hover {
            border-color: var(--primary-accent);
            color: var(--primary-accent);
        }

        .reset-btn.visible {
            display: flex;
        }

        /* Down payment toggle */
        .dp-toggle {
            display: flex;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            margin-left: 6px;
            flex-shrink: 0;
        }

        .dp-toggle button {
            padding: 8px 12px;
            border: none;
            background: transparent;
            color: var(--text-dim);
            font-family: 'Outfit', sans-serif;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dp-toggle button.active {
            background: var(--primary-accent);
            color: var(--bg-color);
        }

        .dp-row {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .dp-row .input-wrapper {
            flex: 1;
        }

        .dp-calculated {
            font-size: 12px;
            color: var(--text-dim);
            margin-top: 4px;
            padding-left: 2px;
        }

        /* Results */
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .result-label {
            color: var(--text-dim);
            font-size: 14px;
        }

        .result-value {
            font-weight: 600;
        }

        .value-cost {
            color: var(--cost-color);
        }

        .value-income {
            color: var(--income-color);
        }

        .profit-summary {
            margin-top: 24px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(8px);
        }

        .profit-total {
            padding: 16px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            text-align: center;
            margin-top: 8px;
        }

        .profit-total-label {
            font-size: 12px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .profit-total-value {
            font-size: 36px;
            font-weight: 700;
            transition: color 0.3s ease;
        }

        /* Section divider */
        .section-divider {
            height: 1px;
            background: var(--border-color);
            margin: 16px 0;
        }

        .section-label {
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            margin-top: 4px;
        }

        /* Total Profit tab */
        .summary-metric {
            text-align: center;
            padding: 16px;
            background: linear-gradient(135deg, rgba(56, 189, 248, 0.05) 0%, rgba(129, 140, 248, 0.05) 100%);
            border: 1px solid rgba(56, 189, 248, 0.2);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .summary-metric-label {
            font-size: 11px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .summary-metric-value {
            font-size: 24px;
            font-weight: 700;
        }

        /* Info button */
        .info-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-dim);
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 12px;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            position: relative;
            flex-shrink: 0;
        }

        .info-btn:hover {
            border-color: var(--primary-accent);
            color: var(--primary-accent);
        }

        .tooltip {
            display: none;
            position: absolute;
            top: 32px;
            right: 0;
            width: 260px;
            padding: 12px 14px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-dim);
            font-size: 12px;
            font-weight: 400;
            line-height: 1.5;
            z-index: 10;
            backdrop-filter: blur(12px);
        }

        .info-btn:hover .tooltip,
        .info-btn:focus .tooltip {
            display: block;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <div class="logo">
                <i data-lucide="bar-chart-3" size="20" stroke-width="2.5"></i>
                <h1>Real Estate Profit Calculator</h1>
            </div>
            <button class="info-btn" aria-label="About this tool">i
                <div class="tooltip">A simple calculator for first-time home buyers to estimate whether a property is a
                    good investment. Enter your costs, expected sale price, and monthly expenses to see your total
                    profit or loss.</div>
            </button>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="buy">Buy</button>
            <button class="tab-btn" data-tab="monthly">Monthly</button>
            <button class="tab-btn" data-tab="sell">Sell</button>
            <button class="tab-btn" data-tab="summary">Profit</button>
        </div>

        <!-- Buy Tab -->
        <div id="buy" class="tab-content active">
            <div class="card">
                <div class="input-group">
                    <label>Home Price</label>
                    <div class="input-wrapper">
                        <span class="prefix">$</span>
                        <input id="homePrice" type="text" inputmode="numeric" value="300,000">
                    </div>
                </div>

                <div class="input-group">
                    <label>Down Payment</label>
                    <div class="dp-row">
                        <div class="input-wrapper">
                            <span class="prefix" id="dpPrefix">%</span>
                            <input id="downPayment" type="text" inputmode="numeric" value="10">
                        </div>
                        <div class="dp-toggle">
                            <button class="active" data-mode="percent">%</button>
                            <button data-mode="dollar">$</button>
                        </div>
                    </div>
                    <div class="dp-calculated" id="dpCalculated">$30,000</div>
                </div>

                <div class="input-group">
                    <label>Interest Rate</label>
                    <div class="input-wrapper">
                        <input id="interestRate" type="text" inputmode="decimal" value="6.5" class="no-prefix"
                            style="padding-right: 30px;">
                        <span class="suffix">%</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>Loan Term</label>
                    <select id="loanTerm">
                        <option value="30" selected>30 years</option>
                        <option value="15">15 years</option>
                    </select>
                </div>

                <div class="display-field" style="margin-bottom: 12px;">
                    <span class="display-label">Monthly Mortgage Payment</span>
                    <span class="display-value" id="monthlyMortgage">$0</span>
                </div>

                <div class="section-divider"></div>

                <div class="input-group">
                    <label>Closing Costs</label>
                    <div class="smart-input-row">
                        <div class="input-wrapper">
                            <span class="prefix">$</span>
                            <input id="closingCosts" type="text" inputmode="numeric" value="9,000">
                        </div>
                        <button class="reset-btn" id="resetClosingCosts"
                            title="Reset to 3% of home price">&#8634;</button>
                    </div>
                </div>

                <div class="input-group">
                    <label>Repairs / Upgrades</label>
                    <div class="input-wrapper">
                        <span class="prefix">$</span>
                        <input id="repairs" type="text" inputmode="numeric" value="0">
                    </div>
                </div>

                <!-- Buy Results -->
                <div class="profit-summary">
                    <div class="profit-total">
                        <div class="profit-total-label">Cash You Need</div>
                        <div class="profit-total-value value-cost" id="buy-cashNeeded">$0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sell Tab -->
        <div id="sell" class="tab-content">
            <div class="card">
                <div class="input-group">
                    <label>Years Owned</label>
                    <input id="yearsOwned" type="number" value="5" min="1" class="no-prefix"
                        style="padding-left: 12px;">
                </div>

                <div class="input-group">
                    <label>Estimated Sale Price</label>
                    <div class="input-wrapper">
                        <span class="prefix">$</span>
                        <input id="salePrice" type="text" inputmode="numeric" value="360,000">
                    </div>
                </div>

                <div class="input-group">
                    <label>Selling Costs</label>
                    <div class="smart-input-row">
                        <div class="input-wrapper">
                            <span class="prefix">$</span>
                            <input id="sellingCosts" type="text" inputmode="numeric" value="21,600">
                        </div>
                        <button class="reset-btn" id="resetSellingCosts"
                            title="Reset to 6% of sale price">&#8634;</button>
                    </div>
                </div>

                <div class="display-field" style="margin-bottom: 0;">
                    <span class="display-label">Remaining Mortgage</span>
                    <span class="display-value" id="remainingMortgage">$0</span>
                </div>

                <!-- Sell Results -->
                <div class="profit-summary">
                    <div class="result-row">
                        <span class="result-label">Sale Price</span>
                        <span class="result-value value-income" id="sell-salePrice">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Selling Costs</span>
                        <span class="result-value value-cost" id="sell-sellingCosts">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Remaining Mortgage</span>
                        <span class="result-value value-cost" id="sell-remainingMortgage">$0</span>
                    </div>
                    <div class="profit-total">
                        <div class="profit-total-label">What You Walk Away With</div>
                        <div class="profit-total-value" id="sell-netProceeds">$0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monthly Costs Tab -->
        <div id="monthly" class="tab-content">
            <div class="card">
                <div class="display-field" style="margin-bottom: 12px;">
                    <span class="display-label">Mortgage Payment</span>
                    <span class="display-value" id="monthly-mortgage">$0</span>
                </div>

                <div class="input-group">
                    <label>PMI (Private Mortgage Insurance)</label>
                    <div class="smart-input-row">
                        <div class="input-wrapper">
                            <span class="prefix">$</span>
                            <input id="pmi" type="text" inputmode="numeric" value="0">
                        </div>
                        <button class="reset-btn" id="resetPmi"
                            title="Reset to 0.75% of loan / 12">&#8634;</button>
                    </div>
                    <div style="font-size: 11px; color: var(--text-dim); margin-top: 3px; padding-left: 2px;">Required when down payment is less than 20%</div>
                </div>

                <div class="input-group">
                    <label>Property Tax</label>
                    <div class="smart-input-row">
                        <div class="input-wrapper">
                            <span class="prefix">$</span>
                            <input id="propertyTax" type="text" inputmode="numeric" value="275">
                        </div>
                        <button class="reset-btn" id="resetPropertyTax"
                            title="Reset to 1.1% of home price / 12">&#8634;</button>
                    </div>
                </div>

                <div class="input-group">
                    <label>Insurance</label>
                    <div class="input-wrapper">
                        <span class="prefix">$</span>
                        <input id="insurance" type="text" inputmode="numeric" value="150">
                    </div>
                </div>

                <div class="input-group">
                    <label>Utilities (electric, water, gas, trash, internet)</label>
                    <div class="input-wrapper">
                        <span class="prefix">$</span>
                        <input id="utilities" type="text" inputmode="numeric" value="250">
                    </div>
                </div>

                <div class="input-group">
                    <label>HOA</label>
                    <div class="input-wrapper">
                        <span class="prefix">$</span>
                        <input id="hoa" type="text" inputmode="numeric" value="0">
                    </div>
                </div>

                <div class="input-group">
                    <label>Maintenance</label>
                    <div class="smart-input-row">
                        <div class="input-wrapper">
                            <span class="prefix">$</span>
                            <input id="maintenance" type="text" inputmode="numeric" value="250">
                        </div>
                        <button class="reset-btn" id="resetMaintenance"
                            title="Reset to 1% of home price / 12">&#8634;</button>
                    </div>
                </div>

                <div class="section-divider"></div>

                <div class="input-group">
                    <label>Monthly Income (rental income, $0 if owner-occupied)</label>
                    <div class="input-wrapper">
                        <span class="prefix">$</span>
                        <input id="monthlyIncome" type="text" inputmode="numeric" value="0">
                    </div>
                </div>

                <!-- Monthly Results -->
                <div class="profit-summary">
                    <div class="result-row">
                        <span class="result-label">Total Monthly Costs</span>
                        <span class="result-value value-cost" id="monthly-totalCosts">$0</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Monthly Cash Flow</span>
                        <span class="result-value" id="monthly-cashFlow">$0</span>
                    </div>
                    <div class="profit-total">
                        <div class="profit-total-label" id="monthly-periodLabel">Total Over 5 Years</div>
                        <div class="profit-total-value" id="monthly-totalOverPeriod">$0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Profit Tab -->
        <div id="summary" class="tab-content">
            <div class="card">
                <div class="summary-metric">
                    <div class="summary-metric-label">Cash to Buy</div>
                    <div class="summary-metric-value value-cost" id="summary-cashToBuy">$0</div>
                </div>

                <div class="summary-metric">
                    <div class="summary-metric-label">What You Walk Away With</div>
                    <div class="summary-metric-value" id="summary-netProceeds">$0</div>
                </div>

                <div class="summary-metric">
                    <div class="summary-metric-label" id="summary-cashFlowLabel">Monthly Cash Flow (5 yrs)</div>
                    <div class="summary-metric-value" id="summary-cashFlow">$0</div>
                </div>

                <div class="profit-total" style="margin-top: 16px;">
                    <div class="profit-total-label">Total Profit / Loss</div>
                    <div class="profit-total-value" id="summary-total">$0</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // --- Helpers ---
        function val(id) {
            return Number(document.getElementById(id).value.replace(/,/g, '')) || 0;
        }

        function fmt(num) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency', currency: 'USD', maximumFractionDigits: 0
            }).format(num);
        }

        function formatInput(el) {
            const raw = el.value.replace(/,/g, '');
            if (raw === '' || raw === '-') return;
            const num = Number(raw);
            if (!isNaN(num)) {
                const pos = el.selectionStart;
                const oldLen = el.value.length;
                el.value = num.toLocaleString('en-US');
                const newLen = el.value.length;
                el.setSelectionRange(pos + newLen - oldLen, pos + newLen - oldLen);
            }
        }

        function setColor(el, value) {
            el.style.color = value >= 0 ? 'var(--success)' : 'var(--error)';
        }

        // --- Smart Defaults ---
        const smartDefaults = {
            closingCosts: { manual: false, calc: () => Math.round(val('homePrice') * 0.03) },
            sellingCosts: { manual: false, calc: () => Math.round(val('salePrice') * 0.06) },
            pmi: {
                manual: false,
                calc: () => {
                    const dp = getDownPaymentDollars();
                    const homePrice = val('homePrice');
                    if (homePrice === 0 || dp / homePrice >= 0.2) return 0;
                    const loan = homePrice - dp;
                    return Math.round(loan * 0.0075 / 12);
                }
            },
            propertyTax: { manual: false, calc: () => Math.round(val('homePrice') * 0.011 / 12) },
            maintenance: { manual: false, calc: () => Math.round(val('homePrice') * 0.01 / 12) },
        };

        function applySmartDefault(id) {
            const sd = smartDefaults[id];
            if (!sd.manual) {
                const v = sd.calc();
                document.getElementById(id).value = v.toLocaleString('en-US');
            }
            const resetBtn = document.getElementById('reset' + id.charAt(0).toUpperCase() + id.slice(1));
            if (resetBtn) {
                resetBtn.classList.toggle('visible', sd.manual);
            }
        }

        function applyAllSmartDefaults() {
            for (const id in smartDefaults) {
                applySmartDefault(id);
            }
        }

        // Wire smart default inputs: mark manual on user edit
        for (const id in smartDefaults) {
            const input = document.getElementById(id);
            input.addEventListener('input', function () {
                smartDefaults[id].manual = true;
                formatInput(this);
                applySmartDefault(id);
                recalcAll();
            });

            const resetBtn = document.getElementById('reset' + id.charAt(0).toUpperCase() + id.slice(1));
            if (resetBtn) {
                resetBtn.addEventListener('click', function () {
                    smartDefaults[id].manual = false;
                    applySmartDefault(id);
                    recalcAll();
                });
            }
        }

        // --- Down Payment Toggle ---
        let dpMode = 'percent'; // 'percent' or 'dollar'

        document.querySelectorAll('.dp-toggle button').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.dp-toggle button').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const newMode = this.dataset.mode;
                const homePrice = val('homePrice');
                const dpInput = document.getElementById('downPayment');
                const prefix = document.getElementById('dpPrefix');

                if (newMode === 'dollar' && dpMode === 'percent') {
                    const pct = parseFloat(dpInput.value.replace(/,/g, '')) || 0;
                    const dollars = Math.round(homePrice * pct / 100);
                    dpInput.value = dollars.toLocaleString('en-US');
                    prefix.textContent = '$';
                } else if (newMode === 'percent' && dpMode === 'dollar') {
                    const dollars = parseFloat(dpInput.value.replace(/,/g, '')) || 0;
                    const pct = homePrice > 0 ? (dollars / homePrice * 100) : 0;
                    dpInput.value = Math.round(pct * 10) / 10;
                    prefix.textContent = '%';
                }
                dpMode = newMode;
                recalcAll();
            });
        });

        function getDownPaymentDollars() {
            const dpVal = parseFloat(document.getElementById('downPayment').value.replace(/,/g, '')) || 0;
            const homePrice = val('homePrice');
            if (dpMode === 'percent') {
                return Math.round(homePrice * dpVal / 100);
            }
            return dpVal;
        }

        function updateDpCalculated() {
            const dollars = getDownPaymentDollars();
            const homePrice = val('homePrice');
            if (dpMode === 'percent') {
                document.getElementById('dpCalculated').textContent = fmt(dollars);
            } else {
                const pct = homePrice > 0 ? (dollars / homePrice * 100) : 0;
                document.getElementById('dpCalculated').textContent = (Math.round(pct * 10) / 10) + '% of home price';
            }
        }

        // --- Mortgage Calculation ---
        function calcMortgagePayment() {
            const homePrice = val('homePrice');
            const dp = getDownPaymentDollars();
            const principal = homePrice - dp;
            if (principal <= 0) return 0;

            const annualRate = parseFloat(document.getElementById('interestRate').value) || 0;
            if (annualRate === 0) return Math.round(principal / (val('loanTerm') * 12));
            const r = annualRate / 100 / 12;
            const n = val('loanTerm') * 12;
            return Math.round(principal * (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1));
        }

        function calcRemainingBalance() {
            const homePrice = val('homePrice');
            const dp = getDownPaymentDollars();
            const principal = homePrice - dp;
            if (principal <= 0) return 0;

            const annualRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const n = val('loanTerm') * 12;
            const years = val('yearsOwned');
            const t = years * 12;

            if (t >= n) return 0;

            if (annualRate === 0) {
                return Math.round(principal * (1 - t / n));
            }

            const r = annualRate / 100 / 12;
            return Math.round(principal * (Math.pow(1 + r, n) - Math.pow(1 + r, t)) / (Math.pow(1 + r, n) - 1));
        }

        // --- Tab Switching ---
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.getElementById(this.dataset.tab).classList.add('active');
                this.classList.add('active');
            });
        });

        // --- Input Event Wiring ---
        const standardInputs = ['homePrice', 'downPayment', 'interestRate', 'repairs', 'salePrice', 'yearsOwned', 'insurance', 'utilities', 'hoa', 'monthlyIncome'];
        standardInputs.forEach(id => {
            const el = document.getElementById(id);
            el.addEventListener('input', function () {
                if (['homePrice', 'repairs', 'salePrice', 'insurance', 'utilities', 'hoa', 'monthlyIncome'].includes(id)) {
                    formatInput(this);
                }
                if (id === 'homePrice' || id === 'salePrice' || id === 'downPayment') {
                    applyAllSmartDefaults();
                }
                if (id === 'homePrice' || id === 'downPayment') {
                    updateDpCalculated();
                }
                recalcAll();
            });
        });

        document.getElementById('loanTerm').addEventListener('change', recalcAll);

        // --- Recalculate Everything ---
        function recalcAll() {
            // Mortgage
            const mortgagePayment = calcMortgagePayment();
            document.getElementById('monthlyMortgage').textContent = fmt(mortgagePayment);
            document.getElementById('monthly-mortgage').textContent = fmt(mortgagePayment);

            // Down payment display
            updateDpCalculated();

            // Buy tab
            const dp = getDownPaymentDollars();
            const closingCosts = val('closingCosts');
            const repairs = val('repairs');
            const cashNeeded = dp + closingCosts + repairs;
            document.getElementById('buy-cashNeeded').textContent = fmt(cashNeeded);

            // Sell tab
            const salePrice = val('salePrice');
            const sellingCosts = val('sellingCosts');
            const remaining = calcRemainingBalance();
            const netProceeds = salePrice - sellingCosts - remaining;

            document.getElementById('remainingMortgage').textContent = fmt(remaining);
            document.getElementById('sell-salePrice').textContent = fmt(salePrice);
            document.getElementById('sell-sellingCosts').textContent = '-' + fmt(sellingCosts);
            document.getElementById('sell-remainingMortgage').textContent = '-' + fmt(remaining);
            const netEl = document.getElementById('sell-netProceeds');
            netEl.textContent = fmt(netProceeds);
            setColor(netEl, netProceeds);

            // Monthly tab
            const pmi = val('pmi');
            const propTax = val('propertyTax');
            const insurance = val('insurance');
            const utilities = val('utilities');
            const hoa = val('hoa');
            const maint = val('maintenance');
            const income = val('monthlyIncome');
            const totalMonthlyCosts = mortgagePayment + pmi + propTax + insurance + utilities + hoa + maint;
            const monthlyCashFlow = income - totalMonthlyCosts;
            const years = val('yearsOwned');
            const months = years * 12;
            const totalOverPeriod = monthlyCashFlow * months;

            document.getElementById('monthly-totalCosts').textContent = fmt(totalMonthlyCosts);
            const cfEl = document.getElementById('monthly-cashFlow');
            cfEl.textContent = fmt(monthlyCashFlow);
            setColor(cfEl, monthlyCashFlow);
            document.getElementById('monthly-periodLabel').textContent = 'Total Over ' + years + ' Year' + (years !== 1 ? 's' : '');
            const topEl = document.getElementById('monthly-totalOverPeriod');
            topEl.textContent = fmt(totalOverPeriod);
            setColor(topEl, totalOverPeriod);

            // Summary tab
            document.getElementById('summary-cashToBuy').textContent = fmt(cashNeeded);
            const snpEl = document.getElementById('summary-netProceeds');
            snpEl.textContent = fmt(netProceeds);
            setColor(snpEl, netProceeds);
            document.getElementById('summary-cashFlowLabel').textContent = 'Monthly Cash Flow (' + years + ' yr' + (years !== 1 ? 's' : '') + ')';
            const scfEl = document.getElementById('summary-cashFlow');
            scfEl.textContent = fmt(totalOverPeriod);
            setColor(scfEl, totalOverPeriod);

            const totalProfit = netProceeds - cashNeeded + totalOverPeriod;
            const stEl = document.getElementById('summary-total');
            stEl.textContent = fmt(totalProfit);
            setColor(stEl, totalProfit);
        }

        // --- Initialize ---
        applyAllSmartDefaults();
        recalcAll();
    </script>
</body>

</html>